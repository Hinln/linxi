# çµçŠ€ (LinXi) - 1Panel éƒ¨ç½²æŒ‡å— (v2.0)

æœ¬æ–‡æ¡£å°†æŒ‡å¯¼æ‚¨å¦‚ä½•ä½¿ç”¨ **1Panel** é¢æ¿å¿«é€Ÿéƒ¨ç½²çµçŠ€ (LinXi) å…¨æ ˆé¡¹ç›®ã€‚æˆ‘ä»¬å°†åˆ©ç”¨ 1Panel çš„å®¹å™¨ç¼–æ’ï¼ˆDocker Composeï¼‰å’Œç½‘ç«™ç®¡ç†ï¼ˆOpenResty/Nginxï¼‰åŠŸèƒ½ã€‚

> **æ³¨æ„**: æœ¬é¡¹ç›®å·²æä¾›ä¸€é”®éƒ¨ç½²è„šæœ¬ `deploy.sh`ï¼Œå¯è‡ªåŠ¨å®Œæˆå¤§éƒ¨åˆ†é…ç½®ã€‚

---

## ğŸ›  å‰ç½®å‡†å¤‡

1.  **æœåŠ¡å™¨è¦æ±‚**ï¼š
    *   æ“ä½œç³»ç»Ÿï¼šUbuntu 20.04+ / CentOS 7+
    *   å†…å­˜ï¼šå»ºè®® 4GB ä»¥ä¸Š (è‹¥ä¸è¶³ä¼šè‡ªåŠ¨åˆ›å»º Swap)
    *   å·²å®‰è£… 1Panel é¢æ¿ã€‚
2.  **ç¯å¢ƒä¾èµ– (é€šè¿‡ 1Panel åº”ç”¨å•†åº—å®‰è£…)**ï¼š
    *   **OpenResty** (ç”¨äºåå‘ä»£ç†)
    *   **PostgreSQL** (æ•°æ®åº“ï¼Œå¯é€‰ï¼Œè„šæœ¬é»˜è®¤ä½¿ç”¨ Docker å†…éƒ¨æ•°æ®åº“ï¼Œä¹Ÿå¯è¿æ¥é¢æ¿æ•°æ®åº“)
    *   **Redis** (ç¼“å­˜ï¼Œå¯é€‰ï¼ŒåŒä¸Š)
3.  **åŸŸå**ï¼š
    *   å‡†å¤‡ä¸¤ä¸ªå­åŸŸåï¼Œåˆ†åˆ«ç”¨äºåç«¯ API (ä¾‹å¦‚ `api.example.com`) å’Œç®¡ç†åå° (ä¾‹å¦‚ `admin.example.com`)ã€‚
    *   ç¡®ä¿åŸŸåå·²è§£æåˆ°æœåŠ¡å™¨ IPã€‚

---

## ğŸš€ å¿«é€Ÿéƒ¨ç½² (æ¨è)

æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå…¨è‡ªåŠ¨éƒ¨ç½²è„šæœ¬ï¼Œæ”¯æŒç¯å¢ƒæ£€æŸ¥ã€ä¾èµ–å®‰è£…ã€ä»£ç æ‹‰å–ã€é…ç½®ç”Ÿæˆå’Œå®¹å™¨å¯åŠ¨ã€‚

### 1. è¿è¡Œä¸€é”®è„šæœ¬
1.  ç™»å½•æœåŠ¡å™¨ SSH (æˆ–ä½¿ç”¨ 1Panel ç»ˆç«¯)ã€‚
2.  æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ (è‡ªåŠ¨ä¸‹è½½å¹¶è¿è¡Œ)ï¼š
    ```bash
    curl -sSL https://raw.githubusercontent.com/Hinln/linxi/main/deploy.sh | sudo bash
    ```
    *(æˆ–è€…æ‰‹åŠ¨ä¸Šä¼  `deploy.sh` å¹¶è¿è¡Œ `chmod +x deploy.sh && ./deploy.sh`)*

### 2. è„šæœ¬äº¤äº’æµç¨‹
è„šæœ¬è¿è¡Œè¿‡ç¨‹ä¸­ä¼šå¼•å¯¼æ‚¨è¿›è¡Œä»¥ä¸‹é…ç½®ï¼š
*   **ç¯å¢ƒæ£€æŸ¥**: è‡ªåŠ¨æ£€æµ‹å†…å­˜ã€ç«¯å£å ç”¨ã€Docker ç¯å¢ƒã€‚
*   **ä»£ç è·å–**: è‡ªåŠ¨ä» Git ä»“åº“æ‹‰å–æœ€æ–°ä»£ç ã€‚
*   **åŸŸåé…ç½®**: è¾“å…¥æ‚¨çš„ API åŸŸåå’Œç®¡ç†åå°åŸŸåï¼Œè„šæœ¬ä¼šè‡ªåŠ¨éªŒè¯è§£æã€‚
*   **é˜¿é‡Œäº‘é…ç½®**: è¾“å…¥ AccessKeyã€OSS Bucketã€çŸ­ä¿¡æ¨¡æ¿ç­‰ä¿¡æ¯ã€‚
*   **æ•°æ®åº“/Redis**: 
    *   é»˜è®¤ä½¿ç”¨ Docker å†…éƒ¨å®¹å™¨ (æ— éœ€é¢å¤–æ“ä½œ)ã€‚
    *   å¦‚æœæ£€æµ‹åˆ°ç«¯å£å†²çªæˆ– 1Panel æœåŠ¡ï¼Œè„šæœ¬ä¼šè¯¢é—®æ˜¯å¦å¤ç”¨é¢æ¿çš„ PostgreSQL/Redisï¼Œå¹¶è‡ªåŠ¨æ³¨å…¥è¿æ¥ä¿¡æ¯ã€‚

### 3. éƒ¨ç½²å®Œæˆ
è„šæœ¬æ‰§è¡Œå®Œæ¯•åï¼Œä¼šè¾“å‡ºï¼š
*   åç«¯ API åœ°å€
*   ç®¡ç†åå°åœ°å€
*   å‰ç«¯é™æ€èµ„æºè·¯å¾„ (é€šå¸¸åœ¨ `linxi-admin/dist`)

---

## ğŸ”§ å¸¸è§é—®é¢˜ä¸ç»´æŠ¤

### 1. ä»£ç æ›´æ–°ä¸é‡æ–°éƒ¨ç½²
å¦‚æœæ‚¨ä¿®æ”¹äº†æœ¬åœ°ä»£ç  (ä¾‹å¦‚ä¿®å¤äº† bug)ï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ›´æ–°æœåŠ¡å™¨ï¼š

1.  **ä¸Šä¼ æ–‡ä»¶**: å°†ä¿®æ”¹åçš„æ–‡ä»¶ (å¦‚ `src/common/aliyun/oss.service.ts`) ä¸Šä¼ åˆ°æœåŠ¡å™¨å¯¹åº”ç›®å½•è¦†ç›–ã€‚
2.  **é‡æ–°æ„å»º**:
    ```bash
    # è¿›å…¥é¡¹ç›®ç›®å½•
    cd /opt/1panel/apps/linxi

    # é‡å»ºå¹¶é‡å¯åç«¯å®¹å™¨
    docker compose up --build -d app
    ```
    > **æ³¨æ„**: å¿…é¡»åŠ ä¸Š `--build` å‚æ•°ï¼Œå¦åˆ™å®¹å™¨ä¸ä¼šåº”ç”¨ä»£ç å˜æ›´ã€‚

### 2. æ•°æ®åº“è¿ç§»
å¦‚æœæ›´æ–°ä»£ç åŒ…å«æ•°æ®åº“å˜æ›´ (Prisma Schema)ï¼Œè¯·æ‰§è¡Œï¼š
```bash
docker compose run --rm app npx prisma migrate deploy
```

### 3. å‰ç«¯éƒ¨ç½² (é™æ€ç½‘ç«™)
è„šæœ¬ä¼šè‡ªåŠ¨æ„å»ºå‰ç«¯å¹¶ç”Ÿæˆ `dist` ç›®å½•ã€‚æ‚¨éœ€è¦åœ¨ 1Panel ä¸­ï¼š
1.  **åˆ›å»ºé™æ€ç½‘ç«™**: åŸŸåå¡«å†™æ‚¨é…ç½®çš„åå°åŸŸå (å¦‚ `admin.example.com`)ã€‚
2.  **ä¸Šä¼ æ–‡ä»¶**: å°† `linxi-admin/dist` ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å¤åˆ¶åˆ°è¯¥ç½‘ç«™çš„è¿è¡Œç›®å½•ã€‚
3.  **é…ç½® Nginx**: åœ¨ç½‘ç«™é…ç½®ä¸­æ·»åŠ ä¼ªé™æ€è§„åˆ™ä»¥æ”¯æŒ History æ¨¡å¼ï¼š
    ```nginx
    location / {
        try_files $uri $uri/ /index.html;
    }
    ```

### 4. é˜¿é‡Œäº‘ OSS æŠ¥é”™ "region must be conform to the specifications"
è¿™æ˜¯å› ä¸ºé…ç½®çš„ Region æ ¼å¼ä¸æ­£ç¡® (ä¾‹å¦‚å¸¦äº† `oss-` å‰ç¼€æˆ– `.aliyuncs.com` åç¼€)ã€‚
*   **è§£å†³æ–¹æ¡ˆ**: æœ€æ–°ç‰ˆä»£ç å·²è‡ªåŠ¨å¤„ç†æ­¤é—®é¢˜ã€‚è¯·ç¡®ä¿åŒæ­¥äº† `oss.service.ts` çš„æœ€æ–°ä¿®å¤ï¼Œå¹¶æ‰§è¡Œ `docker compose up --build -d app`ã€‚

---

## ğŸ“‚ ç›®å½•ç»“æ„è¯´æ˜

```
/opt/1panel/apps/linxi/
â”œâ”€â”€ deploy.sh              # ä¸€é”®éƒ¨ç½²è„šæœ¬
â”œâ”€â”€ docker-compose.yml     # å®¹å™¨ç¼–æ’æ–‡ä»¶
â”œâ”€â”€ linxi-server/          # åç«¯æºç 
â”‚   â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ .env               # åç«¯ç¯å¢ƒå˜é‡ (ç”±è„šæœ¬è‡ªåŠ¨ç”Ÿæˆ)
â””â”€â”€ linxi-admin/           # å‰ç«¯æºç 
    â””â”€â”€ dist/              # å‰ç«¯æ„å»ºäº§ç‰© (é™æ€æ–‡ä»¶)
```
